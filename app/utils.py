from fpdf import FPDF
import datetime, io
def generate_pdf(xray_path, gradcam_path, diagnosis):
    pdf = FPDF()
    pdf.set_auto_page_break(auto=True, margin=15)
    pdf.add_page()

    # Header
    pdf.set_font("Arial", 'B', 16)
    pdf.cell(200, 10, "Medical X-Ray Analysis Report", ln=True, align='C')
    pdf.ln(10)

    # Date & Patient Info
    pdf.set_font("Arial", size=12)
    # pdf.cell(200, 10, f"Patient Name: {patient_name}", ln=True)
    pdf.cell(200, 10, f"Date: {datetime.datetime.now().strftime('%Y-%m-%d %H:%M:%S')}", ln=True)
    pdf.ln(10)

    # X-ray Image
    pdf.set_font("Arial", 'B', 12)
    pdf.cell(200, 10, "Original X-Ray:", ln=True)
    pdf.image(xray_path, x=30, w=150)
    pdf.ln(10)

    # Diagnosis
    pdf.set_font("Arial", 'B', 12)
    pdf.cell(200, 10, "Medical Analysis:", ln=True)
    pdf.set_font("Arial", size=10)
    pdf.multi_cell(0, 10, diagnosis)
    pdf.ln(10)

    # Grad-CAM Image
    pdf.set_font("Arial", 'B', 12)
    pdf.cell(200, 10, "Grad-CAM Heatmap:", ln=True)
    pdf.image(gradcam_path, x=30, w=150)
    pdf.ln(10)

    # Heatmap Explanation
    pdf.set_font("Arial", 'B', 12)
    pdf.cell(200, 10, "Heatmap Interpretation:", ln=True)
    pdf.set_font("Arial", size=10)
    pdf.multi_cell(0, 10, "The Grad-CAM visualization highlights the most important regions used by the model for classification.")
    pdf.ln(10)

    # Signature
    pdf.set_font("Arial", 'B', 12)
    pdf.cell(200, 10, "Report generated by: MedTech Mavericks", ln=True)
    pdf.ln(20)

    # Convert PDF to bytes
    pdf_output = io.BytesIO()
    pdf_output.write(pdf.output(dest='S').encode('latin1'))
    pdf_output.seek(0)

    return pdf_output.getvalue()